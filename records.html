<!DOCTYPE html>
<!-- Coding By CodingNepal - youtube.com/codingnepal -->
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Notes App in JavaScript | CodingNepal</title>
    <link rel="stylesheet" href="records.css" />
    <link rel="stylesheet" href="general.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Iconscout Link For Icons -->
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"
    />
  </head>
  <body>
    <!-- ============================== Main header ============================ -->
    <header class="main-header">
      <a href="index.html" class="logo-home">
        <div class="logo">
          <h1 class="logo-txt">Health-BOX</h1>
          <img src="img/logo.png" alt="" class="logo-img" />
        </div>
      </a>
      <nav class="main-nav">
        <ul class="main-nav-list">
          <li><a href="tips.html" class="main-nav-link">Medical Tips</a></li>
          <li><a href="chatbox.html" class="main-nav-link">Consult</a></li>
          <li><a href="#" class="main-nav-link">Medical Records</a></li>
          <li><a href="#" class="main-nav-link">Link 4</a></li>
          <li><a href="#" class="main-nav-link main-nav-cta">Link 5</a></li>
        </ul>
      </nav>
    </header>
    <div class="records-container">
      <div class="record-header">
        <h1 class="records-title">Here are your Medical records</h1>
        <img src="img/records.png" alt="" class="record-img" />
      </div>
      <div class="popup-box">
        <div class="popup">
          <div class="content">
            <header>
              <p></p>
              <i class="uil uil-times"></i>
            </header>
            <form action="#">
              <div class="row title">
                <label>Specialization</label>
                <input
                  type="text"
                  spellcheck="false"
                  placeholder="Specialization"
                />
              </div>
              <div class="row title">
                <label>Doctor Name</label>
                <input
                  type="text"
                  spellcheck="false"
                  placeholder="Doctor Name"
                />
              </div>
              <div class="row description">
                <label>Recognization</label>
                <textarea
                  spellcheck="false"
                  placeholder="Recognization"
                ></textarea>
              </div>
              <div class="row description">
                <label>Prescription</label>
                <textarea
                  spellcheck="false"
                  placeholder="Prescription"
                ></textarea>
              </div>
              <button></button>
            </form>
          </div>
        </div>
      </div>
      <div class="wrapper">
        <li class="add-box">
          <div class="icon"><i class="uil uil-plus"></i></div>
          <p>Add new Records</p>
        </li>
      </div>
    </div>
    <script>
      const addBox = document.querySelector(".add-box"),
        popupBox = document.querySelector(".popup-box"),
        popupTitle = popupBox.querySelector("header p"),
        closeIcon = popupBox.querySelector("header i"),
        titleTag = popupBox.querySelector("input"),
        descTag = popupBox.querySelector("textarea"),
        addBtn = popupBox.querySelector("button");

      const months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
      ];
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");
      let isUpdate = false,
        updateId;

      addBox.addEventListener("click", () => {
        popupTitle.innerText = "Add a new Record";
        addBtn.innerText = "Add Record";
        popupBox.classList.add("show");
        document.querySelector("body").style.overflow = "hidden";
        if (window.innerWidth > 660) titleTag.focus();
      });

      closeIcon.addEventListener("click", () => {
        isUpdate = false;
        titleTag.value = descTag.value = "";
        popupBox.classList.remove("show");
        document.querySelector("body").style.overflow = "auto";
      });

      function showNotes() {
        if (!notes) return;
        document.querySelectorAll(".note").forEach((li) => li.remove());
        notes.forEach((note, id) => {
          let filterDesc = note.description.replaceAll("\n", "<br/>");
          let liTag = `<li class="note">
                              <div class="details">
                                  <p>${note.title}</p>
                                  <span>${filterDesc}</span>
                              </div>
                              <div class="bottom-content">
                                  <span>${note.date}</span>
                                  <div class="settings">
                                      <i onclick="showMenu(this)" class="uil uil-ellipsis-h"></i>
                                      <ul class="menu">
                                          <li onclick="updateNote(${id}, '${note.title}', '${filterDesc}')"><i class="uil uil-eye"></i>view</li>
                                          <li onclick="deleteNote(${id})"><i class="uil uil-trash"></i>Delete</li>
                                      </ul>
                                  </div>
                              </div>
                          </li>`;
          addBox.insertAdjacentHTML("afterend", liTag);
        });
      }
      showNotes();

      function showMenu(elem) {
        elem.parentElement.classList.add("show");
        document.addEventListener("click", (e) => {
          if (e.target.tagName != "I" || e.target != elem) {
            elem.parentElement.classList.remove("show");
          }
        });
      }

      function deleteNote(noteId) {
        let confirmDel = confirm("Are you sure you want to delete this note?");
        if (!confirmDel) return;
        notes.splice(noteId, 1);
        localStorage.setItem("notes", JSON.stringify(notes));
        showNotes();
      }

      function updateNote(noteId, title, filterDesc) {
        let description = filterDesc.replaceAll("<br/>", "\r\n");
        updateId = noteId;
        isUpdate = true;
        addBox.click();
        titleTag.value = title;
        descTag.value = description;
        popupTitle.innerText = "Record";
        addBtn.innerText = "Close";
      }

      addBtn.addEventListener("click", (e) => {
        e.preventDefault();
        let title = titleTag.value.trim(),
          description = descTag.value.trim();

        if (title || description) {
          let currentDate = new Date(),
            month = months[currentDate.getMonth()],
            day = currentDate.getDate(),
            year = currentDate.getFullYear();

          let noteInfo = {
            title,
            description,
            date: `${month} ${day}, ${year}`,
          };
          if (!isUpdate) {
            notes.push(noteInfo);
          } else {
            isUpdate = false;
            notes[updateId] = noteInfo;
          }
          localStorage.setItem("notes", JSON.stringify(notes));
          showNotes();
          closeIcon.click();
        }
      });
    </script>
  </body>
</html>
